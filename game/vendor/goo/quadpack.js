/* Goo Engine quadpack 
 * Copyright 2015 Goo Technologies AB
 */
(function(window){function f(){"use strict";
define("goo/quadpack/DoubleQuad",["goo/renderer/MeshData"],function(e){function t(t,n,r,i){if(arguments.length===1&&arguments[0]instanceof Object){var s=arguments[0];t=s.width,n=s.height,r=s.tileX,i=s.tileY}this.xExtent=t!==undefined?t*.5:.5,this.yExtent=n!==undefined?n*.5:.5,this.tileX=r||1,this.tileY=i||1;var o=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,o,8,12),this.rebuild()}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.rebuild=function(){var t=this.xExtent,n=this.yExtent,r=this.tileX,i=this.tileY;return this.getAttributeBuffer(e.POSITION).set([-t,-n,0,-t,n,0,t,n,0,t,-n,0,-t,-n,0,-t,n,0,t,n,0,t,-n,0]),this.getAttributeBuffer(e.NORMAL).set([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1]),this.getAttributeBuffer(e.TEXCOORD0).set([0,0,0,i,r,i,r,0,0,0,0,i,r,i,r,0]),this.getIndexBuffer().set([0,3,1,1,3,2,7,4,5,7,5,6]),this},t}),define("goo/quadpack/QuadComponent",["goo/entities/components/Component","goo/quadpack/DoubleQuad","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/shaders/ShaderLib","goo/renderer/Material","goo/util/ObjectUtil","goo/renderer/Texture"],function(e,t,n,r,i,s,o,u){function a(a,f){e.apply(this,arguments),f=f||{};var l={width:1,height:1,tileX:1,tileY:1,preserveAspectRatio:!0};o.defaults(f,l),this.type="QuadComponent",this.width=f.width,this.oldWidth=0,this.height=f.height,this.oldHeight=0,this.tileX=f.tileX,this.oldTileX=0,this.tileY=f.tileY,this.oldTileY=0,this.preserveAspectRatio=f.preserveAspectRatio,this.meshRendererComponent=new r,this.material=new s(i.uber,"QuadComponent default material"),this.meshData=new t(f.width,f.height,f.tileX,f.tileY),this.meshDataComponent=new n(this.meshData);var c=this.material;c.blendState.blending="CustomBlending",c.renderQueue=2e3,c.uniforms.discardThreshold=.1,this.setMaterial(c);if(a){var h=new u(a);h.anisotropy=16,h.wrapS="EdgeClamp",h.wrapT="EdgeClamp",c.setTexture("DIFFUSE_MAP",h)}this.rebuildMeshData()}return a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.prototype.attached=function(e){e.setComponent(e.quadComponent.meshRendererComponent),e.setComponent(e.quadComponent.meshDataComponent)},a.prototype.detached=function(e){e.clearComponent("meshRendererComponent"),e.clearComponent("meshDataComponent")},a.prototype.destroy=function(e){this.meshData.destroy(e)},a.prototype.setMaterial=function(e){this.material=e,this.meshRendererComponent.materials=[e]},a.prototype.rebuildMeshData=function(){var e=this.material,t=e.getTexture("DIFFUSE_MAP");if(!t)return;var n=t.image;if(!n)return;if(this.preserveAspectRatio&&n){var r=n.originalWidth||n.svgWidth||n.width,i=n.originalHeight||n.svgHeight||n.height;this.width=r/100,this.height=i/100}if(this.width!==this.oldWidth||this.height!==this.oldHeight||this.tileX!==this.oldTileX||this.tileY!==this.oldTileY){this.oldWidth=this.width,this.oldHeight=this.height,this.oldTileX=this.tileX,this.oldTileY=this.tileY;var s=this.meshData;s.xExtent=this.width*.5,s.yExtent=this.height*.5,s.tileX=this.tileX,s.tileY=this.tileY,s.rebuild(),s.setVertexDataUpdated()}},a}),define("goo/quadpack/QuadComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil","goo/quadpack/QuadComponent"],function(e,t,n,r,i){function s(){e.apply(this,arguments),this._type="QuadComponent"}return s.prototype=Object.create(e.prototype),s.prototype.constructor=s,e._registerClass("quad",s),s.prototype._create=function(){return new i},s.prototype._remove=function(e){this.world&&this.world.gooRunner&&e.quadComponent.destroy(this.world.gooRunner.renderer.context),e.clearComponent("quadComponent")},s.prototype.update=function(t,n,r){var i=this;return e.prototype.update.call(this,t,n,r).then(function(e){if(!e)return;return i._load(n.materialRef,r).then(function(n){return n.cullState.enabled=!0,t.meshRendererComponent!==e.meshRendererComponent&&t.setComponent(e.meshRendererComponent),t.meshDataComponent!==e.meshDataComponent&&t.setComponent(e.meshDataComponent),e.setMaterial(n),e.rebuildMeshData(),e.meshDataComponent.autoCompute=!0,e})})},s}),require(["goo/quadpack/DoubleQuad","goo/quadpack/QuadComponent","goo/quadpack/QuadComponentHandler"],function(e,t,n){var r=window.goo;if(!r)return;r.DoubleQuad=e,r.QuadComponent=t,r.QuadComponentHandler=n}),define("goo/quadpack/quadpack",function(){});
}try{
if(window.localStorage&&window.localStorage.gooPath){
window.require.config({
paths:{goo:localStorage.gooPath}
});
}else f()
}catch(e){f()}
})(window)